import{r as d,j as e,H as k}from"./app-dgq6IeED.js";import{A as p}from"./AuthenticatedLayout-BNIWevfe.js";import{a as S}from"./html5-qrcode-scanner-DwEaeYfI.js";import"./transition-DlFCgJ4K.js";import"./ApplicationLogo-D2FRNP7v.js";const x="html5qr-code-full-region",v=t=>{let s={};return t.fps&&(s.fps=t.fps),t.qrbox&&(s.qrbox=t.qrbox),t.aspectRatio&&(s.aspectRatio=t.aspectRatio),t.disableFlip!==void 0&&(s.disableFlip=t.disableFlip),s},N=t=>(d.useEffect(()=>{const s=v(t),o=t.verbose===!0;if(!t.qrCodeSuccessCallback)throw"qrCodeSuccessCallback is required callback.";const l=new S(x,s,o);return l.render(t.qrCodeSuccessCallback,t.qrCodeErrorCallback),()=>{l.clear().catch(r=>{console.error("Failed to clear html5QrcodeScanner. ",r)})}},[]),e.jsx("div",{id:x}));function T(){const t="html5qr-code-full-region",[s,o]=d.useState(!1),[l,r]=d.useState(null),[i,m]=d.useState(null),h=async c=>{const b="/member/attend",j=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");try{o(!0),r(null),m(null);const a=await fetch(b,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":j},body:JSON.stringify({token:c})}),u=a.headers.get("content-type")||"";if(!a.ok){if(u.includes("application/json")){const n=await a.json().catch(()=>null);r(n?.message??`Server error ${a.status}`)}else{const n=await a.text().catch(()=>null);r(`Server error ${a.status}: ${n??"no details"}`)}return}if(u.includes("application/json")){const n=await a.json().catch(()=>null);r(n?.message??"Token terkirim"),n?.data&&m(n.data)}else{const n=await a.text().catch(()=>null);console.debug("Non-JSON response from /member/attend:",n),r("Token terkirim (server mengembalikan HTML).")}}catch(a){console.error("Failed to send token",a),r("Gagal mengirim token")}finally{o(!1)}},f=()=>{html5QrCode.stop().then(c=>{}).catch(c=>{})},g=c=>{f(),h(c)};return e.jsxs(p,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-primary",children:"Presensi"}),children:[e.jsx(k,{title:"Presensi"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden bg-white shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6 text-gray-900",children:[e.jsx("div",{id:t,className:"w-full max-w-md border rounded overflow-hidden"}),e.jsx(N,{fps:10,qrbox:250,disableFlip:!1,qrCodeSuccessCallback:g}),e.jsx("div",{className:"mt-3",children:s?e.jsx("div",{className:"text-sm text-blue-600",children:"Mengirim token..."}):l?e.jsx("div",{className:"text-sm text-green-600",children:l}):null}),i&&e.jsx("div",{className:"mt-4 p-4 border rounded bg-green-500",children:e.jsxs("p",{className:"text-base text-white font-regular",children:["Presensi atas nama"," ",e.jsx("span",{className:"font-bold",children:i.committee?.member?.name??"Nama"})," ","pada program kerja"," ",i.attendance_date?.event?.title??"Acara"," ","-"," ",i.attendance_date?.name??"Tanggal"," ","berhasil dilakukan."]})}),e.jsx("p",{className:"mt-3 text-sm text-gray-500",children:"Catatan: Presensi hanya dapat dilakukan jika kamu tergabung ke dalam kepanitiaan."})]})})})})]})}export{T as default};
