import{r as i,j as e,H as j}from"./app-CHQLiDLB.js";import{A as k}from"./AuthenticatedLayout-ClzveHc0.js";import{a as p}from"./html5-qrcode-scanner-uVCIMSOY.js";import"./transition-QGCFaxmb.js";import"./ApplicationLogo-BC61OCTF.js";const x="html5qr-code-full-region",S=t=>{let s={};return t.fps&&(s.fps=t.fps),t.qrbox&&(s.qrbox=t.qrbox),t.aspectRatio&&(s.aspectRatio=t.aspectRatio),t.disableFlip!==void 0&&(s.disableFlip=t.disableFlip),s},v=t=>(i.useEffect(()=>{const s=S(t),c=t.verbose===!0;if(!t.qrCodeSuccessCallback)throw"qrCodeSuccessCallback is required callback.";const l=new p(x,s,c);return l.render(t.qrCodeSuccessCallback,t.qrCodeErrorCallback),()=>{l.clear().catch(r=>{console.error("Failed to clear html5QrcodeScanner. ",r)})}},[]),e.jsx("div",{id:x}));function R(){const t="html5qr-code-full-region",[s,c]=i.useState(!1),[l,r]=i.useState(null),[o,m]=i.useState(null),f=async d=>{const g="/member/attend",b=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");try{c(!0),r(null),m(null);const a=await fetch(g,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":b},body:JSON.stringify({token:d})}),u=a.headers.get("content-type")||"";if(!a.ok){if(u.includes("application/json")){const n=await a.json().catch(()=>null);r(n?.message??`Server error ${a.status}`)}else{const n=await a.text().catch(()=>null);r(`Server error ${a.status}: ${n??"no details"}`)}return}if(u.includes("application/json")){const n=await a.json().catch(()=>null);r(n?.message??"Token terkirim"),n?.data&&m(n.data)}else{const n=await a.text().catch(()=>null);console.debug("Non-JSON response from /member/attend:",n),r("Token terkirim (server mengembalikan HTML).")}}catch(a){console.error("Failed to send token",a),r("Gagal mengirim token")}finally{c(!1)}},h=d=>{f(d)};return e.jsxs(k,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-primary",children:"Presensi"}),children:[e.jsx(j,{title:"Presensi"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden bg-white shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6 text-gray-900",children:[e.jsx("div",{id:t,className:"w-full max-w-md border rounded overflow-hidden"}),e.jsx(v,{fps:10,qrbox:250,disableFlip:!1,qrCodeSuccessCallback:h}),e.jsx("div",{className:"mt-3",children:s?e.jsx("div",{className:"text-sm text-blue-600",children:"Mengirim token..."}):l?e.jsx("div",{className:"text-sm text-green-600",children:l}):null}),o&&e.jsx("div",{className:"mt-4 p-4 border rounded bg-green-500",children:e.jsxs("p",{className:"text-base text-white font-regular",children:["Presensi atas nama"," ",e.jsx("span",{className:"font-bold",children:o.committee?.member?.name??"Nama"})," ","pada program kerja"," ",o.attendance_date?.event?.title??"Acara"," ","-"," ",o.attendance_date?.name??"Tanggal"," ","berhasil dilakukan."]})}),e.jsx("p",{className:"mt-3 text-sm text-gray-500",children:"Catatan: Presensi hanya dapat dilakukan jika kamu tergabung ke dalam kepanitiaan."})]})})})})]})}export{R as default};
