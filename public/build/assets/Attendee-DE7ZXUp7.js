import{r as d,j as e,H as j}from"./app-BrqUwtP2.js";import{A as S}from"./AuthenticatedLayout-C2_J7y5Z.js";import{a as v}from"./html5-qrcode-scanner-uwPBZVC7.js";import"./transition-La2ZOqBA.js";import"./ApplicationLogo-CyL3tFb4.js";const f="html5qr-code-full-region",w=t=>{let s={};return t.fps&&(s.fps=t.fps),t.qrbox&&(s.qrbox=t.qrbox),t.aspectRatio&&(s.aspectRatio=t.aspectRatio),t.disableFlip!==void 0&&(s.disableFlip=t.disableFlip),s},N=t=>(d.useEffect(()=>{const s=w(t),m=t.verbose===!0;if(!t.qrCodeSuccessCallback)throw"qrCodeSuccessCallback is required callback.";const l=new v(f,s,m),r=async(o,i)=>{try{await l.clear()}catch(c){console.error("Failed to clear html5QrcodeScanner after success:",c)}try{t.qrCodeSuccessCallback(o,i)}catch(c){console.error("qrCodeSuccessCallback threw:",c)}};return l.render(r,t.qrCodeErrorCallback),()=>{l.clear().catch(o=>{console.error("Failed to clear html5QrcodeScanner on unmount. ",o)})}},[]),e.jsx("div",{id:f}));function F(){const t="html5qr-code-full-region",[s,m]=d.useState(!1),[l,r]=d.useState(null),[o,i]=d.useState(null),[c,x]=d.useState(null),g=async u=>{const k="/member/attend",p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");try{m(!0),r(null),i(null),x(null);const a=await fetch(k,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({token:u})});i(a.ok);const h=a.headers.get("content-type")||"";if(!a.ok){if(h.includes("application/json")){const n=await a.json().catch(()=>null);r(n?.message??`Server error ${a.status}`)}else{const n=await a.text().catch(()=>null);r(`Server error ${a.status}: ${n??"no details"}`)}return}if(h.includes("application/json")){const n=await a.json().catch(()=>null);r(n?.message??"Token terkirim"),n?.data&&x(n.data)}else{const n=await a.text().catch(()=>null);console.debug("Non-JSON response from /member/attend:",n),r("Token terkirim (server mengembalikan HTML).")}}catch(a){i(!1),console.error("Failed to send token",a),r("Gagal mengirim token")}finally{m(!1)}},b=u=>{g(u)};return e.jsxs(S,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-primary",children:"Presensi"}),children:[e.jsx(j,{title:"Presensi"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden bg-white shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6 text-gray-900",children:[e.jsx("div",{id:t,className:"w-full max-w-md border rounded overflow-hidden"}),e.jsx(N,{fps:10,qrbox:250,disableFlip:!1,qrCodeSuccessCallback:b}),e.jsx("div",{className:"mt-3",children:s?e.jsx("div",{className:"text-sm text-blue-600",children:"Mengirim token..."}):l?e.jsx("div",{className:o?"text-sm text-green-600":"text-sm text-red-600",children:l}):null}),c&&e.jsx("div",{className:"mt-4 p-4 border rounded bg-green-500",children:e.jsxs("p",{className:"text-base text-white font-regular",children:["Presensi atas nama"," ",e.jsx("span",{className:"font-bold",children:c.committee?.member?.name??"Nama"})," ","pada program kerja"," ",c.attendance_date?.event?.title??"Acara"," ","-"," ",c.attendance_date?.name??"Tanggal"," ","berhasil dilakukan."]})}),e.jsx("p",{className:"mt-3 text-sm text-gray-500",children:"Catatan: Presensi hanya dapat dilakukan jika kamu tergabung ke dalam kepanitiaan."})]})})})})]})}export{F as default};
