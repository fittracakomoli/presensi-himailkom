import{r as m,j as e,H as k}from"./app-TewQyCL5.js";import{A as j}from"./AuthenticatedLayout-DrE8_fc1.js";import{a as p}from"./html5-qrcode-scanner-C1WXWLsz.js";import"./transition-BQSozMot.js";import"./ApplicationLogo-CVTRejmI.js";const h="html5qr-code-full-region",S=a=>{let s={};return a.fps&&(s.fps=a.fps),a.qrbox&&(s.qrbox=a.qrbox),a.aspectRatio&&(s.aspectRatio=a.aspectRatio),a.disableFlip!==void 0&&(s.disableFlip=a.disableFlip),s},v=a=>(m.useEffect(()=>{const s=S(a),i=a.verbose===!0;if(!a.qrCodeSuccessCallback)throw"qrCodeSuccessCallback is required callback.";const l=new p(h,s,i),r=async(c,d)=>{try{await l.clear()}catch(o){console.error("Failed to clear html5QrcodeScanner after success:",o)}try{a.qrCodeSuccessCallback(c,d)}catch(o){console.error("qrCodeSuccessCallback threw:",o)}};return l.render(r,a.qrCodeErrorCallback),()=>{l.clear().catch(c=>{console.error("Failed to clear html5QrcodeScanner on unmount. ",c)})}},[]),e.jsx("div",{id:h}));function R(){const a="html5qr-code-full-region",[s,i]=m.useState(!1),[l,r]=m.useState(null),[c,d]=m.useState(null),o=async u=>{const g="/member/attend",b=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");try{i(!0),r(null),d(null);const t=await fetch(g,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":b},body:JSON.stringify({token:u})}),x=t.headers.get("content-type")||"";if(!t.ok){if(x.includes("application/json")){const n=await t.json().catch(()=>null);r(n?.message??`Server error ${t.status}`)}else{const n=await t.text().catch(()=>null);r(`Server error ${t.status}: ${n??"no details"}`)}return}if(x.includes("application/json")){const n=await t.json().catch(()=>null);r(n?.message??"Token terkirim"),n?.data&&d(n.data)}else{const n=await t.text().catch(()=>null);console.debug("Non-JSON response from /member/attend:",n),r("Token terkirim (server mengembalikan HTML).")}}catch(t){console.error("Failed to send token",t),r("Gagal mengirim token")}finally{i(!1)}},f=u=>{o(u)};return e.jsxs(j,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-primary",children:"Presensi"}),children:[e.jsx(k,{title:"Presensi"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden bg-white shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6 text-gray-900",children:[e.jsx("div",{id:a,className:"w-full max-w-md border rounded overflow-hidden"}),e.jsx(v,{fps:10,qrbox:250,disableFlip:!1,qrCodeSuccessCallback:f}),e.jsx("div",{className:"mt-3",children:s?e.jsx("div",{className:"text-sm text-blue-600",children:"Mengirim token..."}):l?e.jsx("div",{className:"text-sm text-green-600",children:l}):null}),c&&e.jsx("div",{className:"mt-4 p-4 border rounded bg-green-500",children:e.jsxs("p",{className:"text-base text-white font-regular",children:["Presensi atas nama"," ",e.jsx("span",{className:"font-bold",children:c.committee?.member?.name??"Nama"})," ","pada program kerja"," ",c.attendance_date?.event?.title??"Acara"," ","-"," ",c.attendance_date?.name??"Tanggal"," ","berhasil dilakukan."]})}),e.jsx("p",{className:"mt-3 text-sm text-gray-500",children:"Catatan: Presensi hanya dapat dilakukan jika kamu tergabung ke dalam kepanitiaan."})]})})})})]})}export{R as default};
